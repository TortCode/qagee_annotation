<!-- You must include this JavaScript file -->
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>

<!-- For the full list of available Crowd HTML Elements and their input/output documentation,
      please refer to https://docs.aws.amazon.com/sagemaker/latest/dg/sms-ui-template-reference.html -->
<style>
  .box {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
  }
</style>

<!-- You must include crowd-form so that your task submits answers to MTurk -->
<crowd-form answer-format="flatten-objects">

    <crowd-instructions link-text="View instructions" link-type="button">
        <short-summary>
            <p>Read the passage and provide question-answer pairs.</p>
        </short-summary>

        <detailed-instructions>
            <h3>Read the passage and provide all possible question-answer pairs about the event triggered by the bolded word (i.e. event trigger) from the entire document.</h3>
            <p>
                The QA pairs will help ascertain arguments/facts about the event. Our goal is to describe the event with a comprehensive list of QA pairs.
                <br>
                <br>The questions must be in this template:
                <br>
                <br><b>wh*</b> verb subject <b>trigger</b> object1 preposition object2
                <br>
                <ul>
                    <li>Wh* is a question word that starts with wh (i.e. who, what, when, where).</li>
                    <li>The subject performs the action.</li>
                    <li>The object is the person, place, or thing being acted upon by the subject's verb.</li>
                    <li>A preposition is a word or group of words used before a noun, pronoun, or noun phrase to show direction, time, place, location, spatial relationships, or to introduce an object.</li>
                    <li>The trigger MUST be mentioned in the question.</li>
                </ul>
                <br>Answers MUST be direct quotes from the passage. Do not ask any inference questions.
                <p>Not every argument of the template must be used. Please make sure answers are accurate and come from direct quotes in the passage</p>
                <br>
            </p>
            <h3>Bootstrap samples</h3>
            <p>Some bootstrap sample QA pairs generated by GPT are at the top of the page. Not all QA pares are correct or relevant, but feel free to copy/paste the samples that are accurate enough.</p>
            <h3>For an example, please refer to this document</h3>
            <a href="https://docs.google.com/document/d/141QeoDYbvJLAelxW-QKpztL85mJ3MfKIzVJSbP4GLKc/edit#heading=h.9nx3vgdwwdkw">Example document</a>
        </detailed-instructions>

        <positive-example>
            <h3>For an example, please refer to this document</h3>
            <a href="https://docs.google.com/document/d/141QeoDYbvJLAelxW-QKpztL85mJ3MfKIzVJSbP4GLKc/edit#heading=h.9nx3vgdwwdkw">Example document</a>
            
        </positive-example>

    </crowd-instructions>
    <div class="box">
      <div>
        <h3>Bootstrap sample QA pairs</h3>
        <p>These are bootstrap question answer pairs generated by GPT. Not all QA pairs are correct or relevant, but feel free to copy/paste the samples that are accurate enough.</p>
        ${bootstrap}
      </div>
      <div>
        <h3>Provide question-answer pairs for the passage below:</h3>
        ${text}
        
        <!-- Your contexts and intents will be substituted for the "context" and "intent" variables when you 
              publish a batch with an input file containing multiple contexts and intents -->
        <p><strong>Trigger: </strong>${trigger}</p>
        <button href="javascript:void(0);" id="add" onclick="generateTextArea()">Add more question-answer pairs</button>
        <button href="javascript:void(0);" id="remove" onclick="removeLastQuestion()">Remove last question</button>
        <script>
            var counter = 1
            function removeLastQuestion() {
                event.preventDefault()
                let questionTextArea = document.getElementById("trigger1-fields-container")
                questionTextArea.removeChild(questionTextArea.lastElementChild);
                counter--
            }
            function generateTextArea() {
                let questionTextArea = document.createElement("div");
                questionTextArea.innerHTML = "<p><strong>Question</strong></p><textarea id='ques" + counter + "' name='Question" + counter + "' placeholder='Provide question here...' rows='2' required></textarea>"+
                    "<p><strong>Answer</strong></p><textarea id='ans" + counter + "' name='Answer" + counter + "' placeholder='Provide answer here...' rows='2' required></textarea>"
                document.getElementById("trigger1-fields-container").appendChild(questionTextArea)
                counter++
            }
            function getQAPairs() {
                let qaPairs = [];
                for (var i = 1; i < counter; i++) {
                    var question = document.getElementById("ques" + i).value;
                    var answer = document.getElementById("ans" + i).value;
                    // error if not all fields filled out 
                    if (!question || !answer) throw Error("Please fill out all fields");
                    qaPairs.push({"question": question, "answer": answer});
                }
                return qaPairs;
            }
        </script>
        <div id="trigger1-fields-container">
        </div>
        
        <button onclick="handleFormSubmit()">Submit</button>
        <form method='post' id='mturk_form' action='https://www.mturk.com/mturk/externalSubmit'>
          <input type="hidden" id="inputAssignmentId" name="assignmentId">
          <input type="hidden" id="inputQAPairs" name="qapairs">
        </form>
        
        <script>
          // add one qa pair to default page
          generateTextArea();
        </script>
        <script>
        function handleFormSubmit() {
          const urlParams = new URLSearchParams(window.location.search)
          document.getElementById('inputAssignmentId').value = urlParams.get('assignmentId');
          try {
            var qapairs = getQAPairs();
          } catch (e) {
            alert(e);
            return;
          }
          let qapairs_string = JSON.stringify(qapairs)
          document.getElementById('inputQAPairs').value = qapairs_string;
          console.log(qapairs);
          console.log(qapairs_string);
          document.getElementById('mturk_form').submit();
        }
        </script>
      </div>
    </div>
</crowd-form>

