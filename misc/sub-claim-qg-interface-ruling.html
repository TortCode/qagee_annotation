<meta content="width=device-width,initial-scale=1" name="viewport" />
<section class="container-fluid" id="Relevancy">
    <div class="row">
        <div class="col-xs-12 col-md-12">
            <div class="panel panel-primary"><a class="panel-heading" href="javascript:void(0);"
                    id="collapseTrigger"><strong>Annotation Instructions</strong> <span class="collapse-text">(Click to
                        expand)</span> </a>
                <div class="panel-body" id="instructionBody">
                    <h3>Read the passage and provide all possible question-answer pairs about the event triggered by the bolded word (i.e. event trigger) from the entire document.</h3>
                    <p>
                        The QA pairs will help ascertain arguments/facts about the event. Our goal is to describe the event with a comprehensive list of QA pairs.
                        <br>
                        <br>The questions must be in this template:
                        <br>
                        <br><b>wh*</b> verb subject <b>trigger</b> object1 preposition object2
                        <br>
                        <ul>
                            <li>Wh* is a question word that starts with wh (i.e. who, what, when, where).</li>
                            <li>The subject performs the action.</li>
                            <li>The object is the person, place, or thing being acted upon by the subject's verb.</li>
                            <li>A preposition is a word or group of words used before a noun, pronoun, or noun phrase to show direction, time, place, location, spatial relationships, or to introduce an object.</li>
                            <li>The trigger MUST be mentioned in the question.</li>
                        </ul>
                        <br>Answers MUST be direct quotes from the passage. Do not ask any inference questions.
                        <p>Not every argument of the template must be used. Please make sure answers are accurate and come from direct quotes in the passage</p>
                        <br>
                    </p>
                    <h3>Bootstrap samples</h3>
                    <p>Some bootstrap sample QA pairs generated by GPT are at the top of the page. Not all QA pares are correct or relevant, but feel free to copy/paste the samples that are accurate enough.</p>
                    <h3>For an example, please refer to this document</h3>
                    <a href="https://docs.google.com/document/d/141QeoDYbvJLAelxW-QKpztL85mJ3MfKIzVJSbP4GLKc/edit#heading=h.9nx3vgdwwdkw">Example document</a>
                </div>
            </div>
        </div>
        <!--    </div>-->
        <input type="hidden" name="fake" />

        <h3> Claim </h3>
        <div id="claim" class="ann well well-sm"> <span id="who" class="who"> Barry DuVal </span> <span id="when_where"
                class="when_where"> stated on September 25, 2015 in an interview: </span> </div>
        <h3> Justification </h3>
        <div id="raw-ruling"> "DuVal said the U.S. is the only major oil-producing nation in the world that bans export
            of its crude oil.
            Two experts we contacted agreed with DuVal’s statement, and officials at the EIA said they’re not aware of
            any other country with similar export restrictions. But the ban is not absolute -- a small portion of U.S.
            crude is exported to Canada." </div>
        <div id="ruling" class="ann well well-sm"> </div>

        <div id="srl_args" class="ann well well-sm">
            [ 're ]#[ We ][SEP][ producing ]#[ oil ]#[ nation ][SEP][ imposed ]#[ self ]#[ ban ][SEP][ exporting ]#[ our
            crude oil ]#[ to other nations ]
        </div>

        <div id="raw_claims" class="ann well well-sm">
            " [ We ] [ 're ] [ the only major oil - producing nation in the world with a self - imposed ban on exporting
            our crude oil to other nations ] . "[SEP]" We 're the only major [ oil ] - [ producing ] [ nation ] in the
            world with a self - imposed ban on exporting our crude oil to other nations . "[SEP]" We 're the only major
            oil - producing nation in the world with a [ self ] - [ imposed ] [ ban ] on exporting our crude oil to
            other nations . "[SEP]" We 're the only major oil - producing nation in the world with a self - imposed ban
            on [ exporting ] [ our crude oil ] [ to other nations ] . "
        </div>

        <form method="post">
            <div class="form-group">
                <p>According to the claim and its justification above, write down one or more binary questions
                    (answerable by yes/no) that is answerable by the justification part. Remember the three rules: (1)
                    Write questions that are <b>helpful to verify the original claim</b>. (2) <b>Don't write questions
                        that are too specific</b>. You should also provide an answer to your question -- yes/no. (3) Add
                    questions from claim if the reasoning part doesn’t cover everything. Also, you should copy-paste the
                    justification text you used to generate the question (usually one sentence).
                </p>
                <p>Many claims have around <b>3 questions</b> that are being addressed. We are most interested in
                    collecting a comprehensive set of these questions, so we encourage you to write a few questions. Use
                    the following buttons to add/remove inputs.
                </p>
                <a href="javascript:void(0);" id="add-input" class="btn btn-success">+</a>
                <a href="javascript:void(0);" id="remove-input" class="btn btn-danger">-</a>
                <div id="input-area">

                </div>
                <input type="text" id="user-output" name="user-output">
                <button id="submit" type="submit" class="btn btn-primary">Submit</button>

            </div>
        </form>


</section>


<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

<style>
    .container-fluid {
        max-width: 1800px;
        margin: 30px;
    }

    #collapseTrigger {
        color: #fff;
        display: block;
        text-decoration: none;
    }

    #submitButton {
        white-space: normal;
    }

    #instructionBody table {
        font-size: 14px;
        margin-top: 10px;
        font-weight: normal;
    }

    #instructionBody table caption {
        text-align: left;
        padding: 0 0 5px 0;
    }


    table,
    td,
    th {
        vertical-align: middle;
    }


    #choice {
        display: block;
        margin-top: 10px;
    }

    .who {
        color: rgba(0, 0, 0, 0.3);

    }

    .when_where {
        color: rgba(0, 0, 0, 0.3);
    }

    .highlight_green {
        background: #afd6c9;
        padding: 1px;
    }

    .highlight_orange {
        background: #f7dec5;
        padding: 1px;
    }

    .input-fields {
        padding: 30px;
        /*padding-top: 20px;*/
        /*padding-bottom: 20px;*/
        /*border: 1px solid;*/
    }

    .btn-group {
        vertical-align: middle;
    }

    .content {
        margin-bottom: 15px;
    }

    .question {
        margin-left: 15px;
        padding-left: 10px;
        border-left: double;
    }

    .radio:first-of-type {
        margin-top: -5px;
    }

    .ann {
        font-size: 16px;
    }

    .disp {
        font-size: 20px;
    }

    .ann>span.token {
        cursor: pointer;
    }

    .ann>span.token:hover {
        text-decoration: underline;
    }

    .ann>strong.annotation:hover {
        text-decoration: line-through;
    }

    input[disabled] {
        color: #000
    }
</style>

<script>
    // ---------------------------------------------------------
    // Config
    // ---------------------------------------------------------

    const radio_names = ["support", "refute", "context"];
    // const PARA_NUM = 3;
    // const instruction_sent = "What's the relationship between the above paragraph and the highlighted part of the claim";

    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var values = {};
    var key;
    var page_num = 0;
    var input_count = 0;
    const prefix = $('#claim').html();

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var evidence = $('#evidence');
    var raw_srl_args = $('#srl_args');
    var raw_claims = $('#raw_claims');
    var raw_ruling = $('#raw-ruling');
    var well = $('#well');
    var submit = $('#submit');
    var choice = $('#choice');
    var user_output = $('#user-output');
    var btn_add = $('#add-input');
    var btn_remove = $('#remove-input');

    // var instructionTable = $('#instruction-table');

    var form = $("#form");
    var answer = {};
    var radios = {};
    // answerHiddenDuplicates value of answer but is needed because
    // otherwise the data is not sent

    // list of strings
    var separated_claims = raw_claims.text().trim().split('[SEP]');
    var separated_srl_args = raw_srl_args.text().trim().split('[SEP]');
    var separated_ruling_sents = raw_ruling.text().split('\n');
    // const total_claims = separated_claims.length;
    // to be consistent with SRL args
    separated_claims.push(separated_claims[separated_claims.length - 1]);
    separated_srl_args.push('other#');


    // implementation of string formatting
    if (!String.prototype.format) {
        String.prototype.format = function () {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function (match, number) {
                return typeof args[number] != 'undefined'
                    ? args[number]
                    : match
                    ;
            });
        };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeFormRow = function (text, count) {
        var btn_group = ($('<div>')
            .addClass('btn-group btn-group-md')
            .attr({ 'data-toggle': 'buttons' })
        );

        for (var name of radio_names) {
            var radio_id = name + "-choice" + count;
            var input = ($(
                '<input>')
                .attr({
                    'name': 'sent-type-choice' + count, 'id': radio_id,
                    'value': name, 'type': 'radio', 'data-key': name
                })
                .text(name)
            );
            radios[radio_id] = input;
            var label = ($(
                '<label>')
                .addClass('btn btn-default')
                .text(name)
                .append(input)
                .attr({ 'title': name })
            );
            btn_group.append(label);
        }
        evidence.append(
            $('<div>')
                .addClass('row')
                .append($('<div>')
                    .addClass('col-md-9')
                    .append($('<div>')
                        .addClass('ann well well-sm')
                        .html("[" + count + "] " + text)
                    )
                )
                .append($('<div>')
                    .addClass('col-md-3')
                    .append(btn_group)
                )
        );
    };

    var make_claim = function (claim_num) {
        // console.log(claim_num);
        if (claim_num > separated_claims.length) {
            claim_num = separated_claims.length - 1;
        }
        let claim = $('#claim');
        let cur_claim = separated_claims[claim_num];
        cur_claim = cur_claim.replaceAll('[ ', '');
        cur_claim = cur_claim.replaceAll(' ]', '');
        // console.log(separated_claims);
        // console.log(cur_claim);
        // console.log(prefix);
        let formatted_content = prefix + cur_claim;
        claim.html(formatted_content);
    };

    var make_ruling = function () {
        for (const sent of separated_ruling_sents) {
            $('#ruling')
                .append($('<p>').text(sent))
        }
    };



    var makeDom = function (page_count) {
        make_claim(page_count);
        make_ruling();
    };



    // ensure something is in the input box
    const mini_length = "no valid question".length;
    var canSubmit = function () {
        for (const i of Array(input_count).keys()) {
            if ($('#input-question' + i).val() === '' || $('#input-answer' + i).val() === ''
                || $('#input-evidence' + i).val() === '' || $('#input-from-where' + i).val() === '') {
                return false;
            }
        }
        return true;
    };

    var highlight = function (source, target, type) {
        // console.log("entering highlihgt func");
        console.log(source.html());
        console.log(target);
        text_html = source.html().replace(target, "<span class=" + type + ">" + target + "</span>");
        source.html(text_html);
        console.log(source);
    };

    var enable_button = function (button) {
        button.removeAttr("disabled");
        button.removeClass("btn-default");
        button.addClass("btn-success");
    };

    var disable_button = function (button) {
        button.attr("disabled", "disabled");
        button.removeClass("btn-success");
        button.addClass("btn-default");
    };

    var select_button = function (button) {
        button.removeClass("btn-default");
        button.addClass("btn-primary");
    }

    var deselect_button = function (button) {
        button.removeClass("btn-primary");
        button.addClass("btn-default");
    }

    var is_wh_question = function (question) {
        let tokens = question.split(' ');
        if (tokens.length <= 1) {
            return false;
        }
        console.log(tokens);
        // let wh_pattern = /^Wh\|wh\|How\|how/;
        let wh_pattern = /^wh|Wh|how|How/;
        // console.log(question.match(wh_pattern));
        return !!question.match(wh_pattern);
    };

    var show = function () {
        // for(button of document.getElementById('button-bar').getElementsByTagName('*')) {
        //     if(page_num == button.getAttribute('page-no'))
        //         select_button($("#" + button.getAttribute('id')));
        //     else
        //         deselect_button($("#" + button.getAttribute('id')));
        // }

        if (canSubmit()) {
            enable_button(submit);
            // enable_button($('#next-btn'));
        } else {
            disable_button(submit);
            // disable_button($('#next-btn'));
        }
    };


    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    // event handler
    let input_change = $('#input-question');
    input_change.on("input", function () {
        // console.log(input_change.val());
        input_record[page_num]['input-question'] = input_change.val();
        if (is_wh_question(input_change.val())) {
            window.alert("It seems you are not writing a yes/no question, make sure " +
                "you are writing questions of which the answer is yes or no!")
        }
        show();
    });

    btn_add.on('click', function () {
        console.log('click input plus');
        let question_text = $('<p>').text('question:');
        let question_input = $('<textarea>')
            .addClass('form-control')
            .attr({
                'id': 'input-question' + input_count,
                'name': 'input-question' + input_count,
                'placeholder': 'write down your question',
                'rows': 1
            });
        question_input.on("input", function () {
            if (is_wh_question(question_input.val())) {
                window.alert("It seems you are not writing a yes/no question, make sure " +
                    "you are writing questions of which the answer is yes or no!")
            }
            show();
        });
        let answer_text = $('<p>').text('answer:');
        let answer_input = $('<textarea>')
            .addClass('form-control')
            .attr({
                'id': 'input-answer' + input_count,
                'name': 'input-answer' + input_count,
                'placeholder': 'yes, no, unknown',
                'rows': 1
            });
        answer_input.on("input", function () {
            show();
        });
        let evidence_text = $('<p>').text('text used to generate the question:');
        let evidence_input = $('<textarea>')
            .addClass('form-control')
            .attr({
                'id': 'input-evidence' + input_count,
                'name': 'input-evidence' + input_count,
                'placeholder': 'copy-paste the related text',
                'rows': 1
            });
        evidence_input.on("input", function () {
            show();
        });

        let from_where_text = $('<p>').text('text from reasoning or claim:');
        let from_where_input = $('<textarea>')
            .addClass('form-control')
            .attr({
                'id': 'input-from-where' + input_count,
                'name': 'input-from-where' + input_count,
                'placeholder': 'reasoning/claim',
                'rows': 1
            });
        from_where_input.on("input", function () {
            show();
        });

        let input_fields = ($(
            '<div>').addClass('input-fields')
            .append(question_text)
            .append(question_input)
            .append(answer_text)
            .append(answer_input)
            .append(evidence_text)
            .append(evidence_input)
            .append(from_where_text)
            .append(from_where_input));
        $('#input-area').append(input_fields);
        input_count += 1;
        show();
    });

    btn_remove.on('click', function () {
        // let input_area = $('#input-area');
        $('#input-area').children().last().remove();
        input_count -= 1;
        show();
    });

    // collect all user inputs and pipe them to a json record
    submit.on('click', function () {
        let input_record = [];
        for (const i of Array(input_count).keys()) {
            console.log(input_record);
            input_record.push({
                "question": $('#input-question' + i).val(),
                "answer": $('#input-answer' + i).val(),
                "evidence": $('#input-evidence' + i).val(),
                "from-where": $('#input-from-where' + i).val()
            });
            // console.log('input question:', $('#input-question'+i).val());
            // console.log('input answer:', $('#input-answer'+i).val());
            // console.log('input evidence:', $('#input-evidence'+i).val());
        }
        let json_string = JSON.stringify(input_record);
        user_output.val(json_string);
        console.log(json_string);
    });


    // Instructions expand/collapse
    var content = $('#instructionBody');
    var trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    trigger.click(function () {
        content.toggle();
        var isVisible = content.is(':visible');
        if (isVisible) {
            $('.collapse-text').text('(Click to collapse)');
        } else {
            $('.collapse-text').text('(Click to expand)');
        }
    });

    raw_srl_args.hide();
    raw_claims.hide();
    user_output.hide();
    raw_ruling.hide();
    btn_add.click();
    // btn_add.click();
    // btn_add.click();
    // submit.hide();

    show();

</script>
                                </td>
                            </tr>

                            <tr>
                                <td> <span class="who"> A Facebook post </span> <span class="when_where"> stated on
                                        January 31, 2021: </span> "Nancy Pelosi bought $1.25 million in Tesla stock the
                                    day before Joe Biden signed an order “for all federal vehicles” to be electric."
                                </td>
                                <td>
                                    <p> "An image shared on Facebook claims that Nancy Pelosi bought $1.25 million in
                                        Tesla stock the day before Biden signed an order "for all federal vehicles" to
                                        be electric, implying that she sought to profit from inside information about
                                        new government policies.
                                        The House speaker did report transactions involving Tesla stock, but the post
                                        misrepresented the purchases and Biden’s policies to <span
                                            class="highlight_green">create the false impression that the transactions
                                            represented improper insider trading in Tesla shares</span>.
                                        The statement contains an element of truth, but ignoring critical facts would
                                        give a different impression.
                                    </p>
                                </td>
                                <td> Were the stock purchases improper insider trading? (No)
                                </td>
                                <td>The first part of this sentence talks about that the the stock purchases and Biden’s
                                    policy were misrepresented, but both the purchase and the policy are mentioned in
                                    the original claim. Therefore, we don’t ask the questions about the two parts here.
                                    This sentence also mentions the claim gives a false impression that this purchase
                                    involves insider trading, so we ask the above question here.</td>
                            </tr>




                            <tr>
                                <td> <span class="who"> A Facebook post </span> <span class="when_where"> stated on